<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lapor Kendala</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
<div class="container">
  <h2>Lapor Kendala</h2>

  <label>Lokasi</label>
  <input id="lokasi" placeholder="Contoh: Lantai 2 - Ruang Server">

  <label>Kategori</label>
  <select id="kategori">
    <option value="Internet">Internet</option>
    <option value="Komputer">Komputer</option>
    <option value="Aplikasi">Aplikasi</option>
    <option value="Listrik">Listrik</option>
    <option value="Lainnya">Lainnya</option>
  </select>

  <label>Deskripsi</label>
  <textarea id="deskripsi" placeholder="Jelaskan kendalanya"></textarea>

  <label>Upload Foto (opsional)</label>
  <input type="file" id="foto" accept="image/*">

  <button onclick="kirim()">Kirim Laporan</button>

  <p style="text-align:center;margin-top:20px">
    <a href="dashboard_public.html">Lihat Dashboard Publik</a>
  </p>
</div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbycJc7oMgPazk-IPfeE7F7GaFsMK9NWZM6bylP91rP8kgtqP07XH6goyqGltE32jIl6/exec";

async function kirim(){
  const lokasi = document.getElementById("lokasi").value.trim();
  const kategori = document.getElementById("kategori").value;
  const deskripsi = document.getElementById("deskripsi").value.trim();
  const fotoFile = document.getElementById("foto").files[0];

  if(!lokasi || !deskripsi){
    alert("Lokasi dan Deskripsi wajib diisi!");
    return;
  }

  let fotoBase64 = "";

  if(fotoFile){
    fotoBase64 = await toBase64(fotoFile);
  }

  const data = {
    lokasi, kategori, deskripsi, foto: fotoBase64
  };

  await fetch(GAS_URL, {
    method:"POST",
    body: JSON.stringify(data)
  });

  alert("Laporan berhasil dikirim!");
  location.reload();
}

function toBase64(file){
  return new Promise((resolve,reject)=>{
    const reader = new FileReader();
    reader.onload = ()=>resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}
</script>
</body>
</html>
