<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard Publik - Aplikasi Lapor</title>
  <link rel="stylesheet" href="style.css" />

  <style>
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      margin-top: 20px;
      border-radius: 8px;
      overflow: hidden;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      font-size: 14px;
    }
    th {
      background: #1c82e3;
      color: white;
      text-align: left;
    }
    tr:hover {
      background: #f1f1f1;
      cursor: pointer;
    }
    .status {
      padding: 4px 8px;
      border-radius: 6px;
      color: white;
      font-size: 12px;
    }
    .Open { background:#d93025; }
    .Progress { background:#f9ab00; }
    .Selesai { background:#188038; }
    
    #detailBox {
      margin-top: 20px;
      padding: 15px;
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      display: none;
    }

    #lastUpdate {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }
  </style>
</head>

<body>
<div class="container">
  <h2>Dashboard Publik</h2>
  <p>Daftar laporan terbaru (auto-refresh 10 detik)</p>
  <p id="lastUpdate"></p>

  <table id="laporanTable">
    <thead>
      <tr>
        <th>Tanggal</th>
        <th>Lokasi</th>
        <th>Kategori</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="detailBox"></div>
</div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbycJc7oMgPazk-IPfeE7F7GaFsMK9NWZM6bylP91rP8kgtqP07XH6goyqGltE32jIl6/exec";

// Ambil data dari Apps Script
async function loadData() {
  try {
    const res = await fetch(GAS_URL + "?t=" + Date.now()); // hindari cache
    const data = await res.json();

    const tbody = document.querySelector("#laporanTable tbody");
    tbody.innerHTML = "";

    data.forEach((item) => {
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>${item.tgl}</td>
        <td>${item.lokasi}</td>
        <td>${item.kategori}</td>
        <td>
          <span class="status ${item.status}">${item.status}</span>
        </td>
      `;

      tr.onclick = () => showDetail(item);
      tbody.appendChild(tr);
    });

    const d = new Date();
    document.getElementById("lastUpdate").innerText =
      "Terakhir diperbarui: " + d.toLocaleTimeString("id-ID");

  } catch (err) {
    console.error("Gagal memuat data:", err);
  }
}

// Tampilkan detail laporan
function showDetail(item) {
  const box = document.getElementById("detailBox");
  box.style.display = "block";

  box.innerHTML = `
    <h3>Detail Laporan</h3>
    <p><b>Tanggal:</b> ${item.tgl} ${item.jam}</p>
    <p><b>Lokasi:</b> ${item.lokasi}</p>
    <p><b>Kategori:</b> ${item.kategori}</p>
    <p><b>Deskripsi:</b><br>${item.deskripsi}</p>
    <p><b>Status:</b> ${item.status}</p>
    <p><b>Teknisi:</b> ${item.teknisi || "-"}</p>
    <p><b>Waktu Mulai:</b> ${item.waktu_progress || "-"}</p>
    <p><b>Waktu Selesai:</b> ${item.waktu_selesai || "-"}</p>
  `;
}

// Load awal
loadData();

// Auto refresh tiap 10 detik
setInterval(loadData, 10000);
</script>
</body>
</html>
