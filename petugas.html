<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Petugas</title>

  <style>
    body { font-family: Arial; background:#eef2f5; margin:0; padding:0; }
    header { background:#005cb9; color:#fff; padding:15px; text-align:center; font-size:22px; }
    .container { padding:15px; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:10px; border-bottom:1px solid #ccc; }
    th { background:#0077dd; color:white; }
    select, input {
      padding:6px; width:100%; border:1px solid #aaa; border-radius:6px;
    }
    button {
      padding:8px 15px; background:#28a745; color:white;
      border:none; border-radius:6px; cursor:pointer;
    }
    button:hover { opacity:0.8; }
  </style>
</head>

<body>
<header>Dashboard Petugas</header>

<div class="container">
  <table>
    <thead>
      <tr>
        <th>Waktu</th>
        <th>Nama</th>
        <th>Ruangan</th>
        <th>Keterangan</th>
        <th>Foto</th>
        <th>Status</th>
        <th>Petugas</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody id="laporanBody"></tbody>
  </table>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwMnRtX47fiyahOf51qRBJeaj8JIif5IVvv5e7t1WSbE_uoDoFpVQlHtq6Q1wvUZAyMDA/exec";

async function loadLaporan() {
  const res = await fetch(API_URL + "?action=getAll");
  const data = await res.json();

  const body = document.getElementById("laporanBody");
  body.innerHTML = "";

  data.forEach(r => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${r.tanggal}</td>
      <td>${r.nama}</td>
      <td>${r.ruangan}</td>
      <td>${r.keterangan}</td>
      <td><a href="${r.foto}" target="_blank">Lihat</a></td>

      <td>
        <select id="status-${r.id}">
          <option ${r.status=="Menunggu"?"selected":""}>Menunggu</option>
          <option ${r.status=="Proses"?"selected":""}>Proses</option>
          <option ${r.status=="Selesai"?"selected":""}>Selesai</option>
        </select>
      </td>

      <td>
        <input id="petugas-${r.id}" value="${r.petugas || ""}" placeholder="Nama petugas">
      </td>

      <td>
        <button onclick="updateLaporan('${r.id}')">Update</button>
      </td>
    `;
    body.appendChild(tr);
  });
}

async function updateLaporan(id) {
  const status = document.getElementById("status-" + id).value;
  const petugas = document.getElementById("petugas-" + id).value;

  const res = await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "updateStatus",
      id,
      status,
      petugas
    })
  });

  const result = await res.json();
  alert(result.message || "Update berhasil!");
  loadLaporan();
}

loadLaporan();
</script>
</body>
</html>
