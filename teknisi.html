<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Panel Teknisi</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<main>
<h1>Panel Teknisi</h1>
<label>Nama Teknisi
<input type="text" id="namaTeknisi">
<button id="addTech">Tambah Nama</button>
</label>
<table id="tblLaporan">
<thead>
<tr>
<th>ID</th><th>Nama</th><th>Divisi</th><th>Jenis</th>
<th>Deskripsi</th><th>Foto</th><th>Status</th><th>Teknisi</th><th>Aksi</th>
</tr>
</thead>
<tbody></tbody>
</table>
<div id="statusMsg"></div>
</main>
<script>
const GAS_URL="https://script.google.com/macros/s/AKfycbycJc7oMgPazk-IPfeE7F7GaFsMK9NWZM6bylP91rP8kgtqP07XH6goyqGltE32jIl6/exec";
const tblBody=document.querySelector('#tblLaporan tbody');
const statusMsg=document.getElementById('statusMsg');
const namaTeknisiInput=document.getElementById('namaTeknisi');

async function loadLaporan(){
  const resp=await fetch(GAS_URL+'?action=list');
  const j=await resp.json();
  if(!j.success){ statusMsg.textContent="Error load laporan"; return; }
  tblBody.innerHTML='';
  j.data.forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${r.rowId}</td><td>${r.nama}</td><td>${r.divisi}</td><td>${r.jenis}</td>
      <td>${r.deskripsi}</td>
      <td>${r.fotoUrl?'<a href="'+r.fotoUrl+'" target="_blank">Lihat</a>':''}</td>
      <td>${r.status}</td><td>${r.teknisi}</td>
      <td>
        <select class="statusSel">
          <option value="Proses" ${r.status==='Proses'?'selected':''}>Proses</option>
          <option value="Selesai" ${r.status==='Selesai'?'selected':''}>Selesai</option>
        </select>
        <button class="btnUpdate">Update</button>
      </td>`;
    tblBody.appendChild(tr);

    const btn=tr.querySelector('.btnUpdate');
    const sel=tr.querySelector('.statusSel');
    btn.onclick=async ()=>{
      const data={action:'update',rowId:r.rowId,status:sel.value,teknisi:namaTeknisiInput.value};
      const resp=await fetch(GAS_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});
      const j=await resp.json();
      statusMsg.textContent=j.success?'Update berhasil':'Error: '+j.error;
      loadLaporan();
    };
  });
}

document.getElementById('addTech').onclick=async()=>{
  const nama=namaTeknisiInput.value.trim();
  if(!nama) return alert('Isi nama teknisi');
  const resp=await fetch(GAS_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'addtech',nama})});
  const j=await resp.json();
  alert(j.success?'Teknisi ditambahkan':'Gagal: '+j.error);
  loadLaporan(); namaTeknisiInput.value='';
};

loadLaporan(); setInterval(loadLaporan,10000);
</script>
</body>
</html>
