<h1>Lapor Kerusakan</h1>
<form id="laporForm">
  <input type="text" id="nama" placeholder="Nama Pelapor" required>
  <input type="text" id="divisi" placeholder="Divisi / Ruangan" required>
  <select id="jenis" required>
    <option>Listrik</option><option>Internet</option><option>Komputer</option><option>Lainnya</option>
  </select>
  <textarea id="deskripsi" placeholder="Deskripsi Kendala"></textarea>
  <input type="file" id="foto" accept="image/*" capture="camera">
  <button type="submit">Kirim</button>
</form>
<div id="statusMsg"></div>

<script>
const form = document.getElementById('laporForm');
form.addEventListener('submit', async e=>{
  e.preventDefault();
  const file = document.getElementById('foto').files[0];
  let fotoDataUrl=null;
  if(file){
    fotoDataUrl = await new Promise((res,rej)=>{
      const r = new FileReader();
      r.onload=()=>res(r.result);
      r.onerror=()=>rej("Gagal convert");
      r.readAsDataURL(file);
    });
  }
  google.script.run.withSuccessHandler(resp=>{
    document.getElementById('statusMsg').textContent = resp.success?"Laporan Terkirim!":"Gagal";
  }).apiAddLaporan({
    nama:document.getElementById('nama').value,
    divisi:document.getElementById('divisi').value,
    jenis:document.getElementById('jenis').value,
    deskripsi:document.getElementById('deskripsi').value,
    fotoDataUrl
  });
});
</script>
