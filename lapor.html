<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Form Laporan</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<main>
<h1>Kirim Laporan Kerusakan</h1>
<form id="laporForm">
<label>Nama Pelapor
<input type="text" id="nama" required>
</label>
<label>Divisi / Ruangan
<input type="text" id="divisi" required>
</label>
<label>Jenis Kendala
<select id="jenis" required>
<option value="Listrik">Listrik</option>
<option value="Internet">Internet</option>
<option value="Komputer">Komputer</option>
<option value="Lainnya">Lainnya</option>
</select>
</label>
<label>Deskripsi Kendala
<textarea id="deskripsi" rows="4" required></textarea>
</label>
<label>Foto Bukti
<input type="file" id="foto" accept="image/*" capture="environment">
</label>
<button type="submit">Kirim Laporan</button>
<div id="statusMsg"></div>
</form>
</main>
<script>
const GAS_URL="https://script.google.com/macros/s/AKfycbwfjO3BiO1sd3cIV5i3jYMF5ORmsGb4zJEmjmTnMpUhbTxClZ5xIqjrEJtw5Vj9RZi6Rw/exec";

function dataURLfromFile(file){
  return new Promise((res,rej)=>{
    if(!file){ res(null); return; }
    const reader=new FileReader();
    reader.onload=()=>res(reader.result);
    reader.onerror=()=>rej('Gagal convert file');
    reader.readAsDataURL(file);
  });
}

document.getElementById('laporForm').addEventListener('submit',async e=>{
  e.preventDefault();
  const nama=document.getElementById('nama').value.trim();
  const divisi=document.getElementById('divisi').value.trim();
  const jenis=document.getElementById('jenis').value;
  const deskripsi=document.getElementById('deskripsi').value.trim();
  const fotoFile=document.getElementById('foto').files[0];
  const statusMsg=document.getElementById('statusMsg');
  statusMsg.textContent='Mengunggah...';
  try{
    const fotoDataUrl=await dataURLfromFile(fotoFile);
    const payload={action:'add',nama,divisi,jenis,deskripsi,fotoDataUrl};
    const resp=await fetch(GAS_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    const j=await resp.json();
    if(j.success){ statusMsg.textContent='Laporan terkirim. ID:'+j.id; document.getElementById('laporForm').reset(); }
    else statusMsg.textContent='Gagal: '+(j.error||'Unknown');
  }catch(err){ statusMsg.textContent='Error: '+err; }
});
</script>
</body>
</html>

